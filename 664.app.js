(()=>{"use strict";var e,n,a,s;!function(e){e.creatingSession="REPLICATION_CREATING_SESSION",e.connectionReady="REPLICATION_CONNECTION_READY",e.connectionClosed="REPLICATION_CONNECTION_CLOSED",e.connectionError="REPLICATION_CONNECTION_ERROR",e.receiveMessage="REPLICATION_RECEIVE_MESSAGE",e.sendPing="REPLICATION_SEND_PING",e.noop="REPLICATION_NOOP"}(e||(e={})),function(e){e.create="SESSION_CREATE",e.started="SESSION_STARTED",e.ended="SESSION_ENDED",e.join="SESSION_JOIN",e.leave="SESSION_LEAVE",e.addUser="SESSION_ADD_USER",e.removeUser="SESSION_REMOVE_USER",e.changeUserName="SESSION_CHANGE_USER_NAME",e.userNameChanged="SESSION_USER_NAME_CHANGED",e.sendMessage="REPLICATION_SEND_MESSAGE"}(n||(n={})),function(e){e.action="ACTION",e.joined="JOINED",e.userJoined="USER_JOINED",e.userLeft="USER_LEFT",e.userChangedName="USER_CHANGED_NAME"}(a||(a={})),function(e){e.action="ACTION",e.create="CREATE",e.join="JOIN",e.ping="PING",e.changeName="CHANGE_NAME",e.leave="LEAVE"}(s||(s={}));let E=null,N=null,o=null,S=!1;onmessage=e=>{let n=e.data;switch(n.func){case"CREATE":return E=l(n.payload.serverAddress,n.payload.serializableState),null;case"JOIN":return E=d(n.payload.serverAddress,n.payload.sessionId),null;case"CHANGE_NAME":return E&&N&&((e,n)=>{e.send(JSON.stringify({command:s.changeName,payload:{name:n}}))})(E,n.payload.newName),null;case"TERMINATE":return E&&O(E),null;case"SEND":E&&N&&((e,n)=>{e.send(JSON.stringify(n))})(E,n.payload.message);default:return null}};const t=e=>{postMessage(e)},r=e=>{let n=new WebSocket(e);return n.onmessage=e=>c(e),n.onclose=e=>i(e),n.onerror=e=>_(e),n},l=(e,n)=>{let a=r(e);return I(a),a.onopen=e=>{((e,n)=>{e.send(JSON.stringify({command:s.create,payload:{state:n}}))})(a,n)},a},d=(e,n)=>{let a=r(e);return I(a),a.onopen=e=>{((e,n)=>{e.send(JSON.stringify({command:s.join,payload:{sessionId:n}}))})(a,n)},a},I=e=>{o=setInterval((()=>{(e=>{e.send(JSON.stringify({command:s.ping}))})(e)}),1e3)},O=e=>{S=!0,N=null,null!==o&&clearInterval(o);try{(e=>{e.send(JSON.stringify({command:s.leave})),e.close()})(e),e.close()}catch(e){}},c=n=>{let s=JSON.parse(n.data);var E;s.command==a.joined&&(N=s.payload.sessionId,t({event:"SESSION_ID",payload:s.payload})),null!==N&&(E={type:e.receiveMessage,payload:{message:s,sessionId:N}},t({event:"DISPATCH",payload:{action:E}}))},i=e=>{E&&O(E),t({event:"CLOSE"})},_=e=>{E&&O(E),t({event:"ERROR"})}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VXJCLEdBQ2RzQixFQUFXLENBQUVzQixNQUFPLFNBQVUsQyIsInNvdXJjZXMiOlsid2VicGFjazovL3NxdWFkc3RyYXQvLi9zcmMvcmVwbGljYXRpb25fd3MvdHlwZXMudHMiLCJ3ZWJwYWNrOi8vc3F1YWRzdHJhdC8uL3NyYy9yZXBsaWNhdGlvbl93cy9jb25uZWN0aW9uV29ya2VyLnRzIiwid2VicGFjazovL3NxdWFkc3RyYXQvLi9zcmMvcmVwbGljYXRpb25fd3Mvd2Vic29ja2V0UHJpbWl0aXZlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgbmV3U2Vzc2lvbiA9ICgpID0+ICh7XHJcbiAgICBzZXNzaW9uSWQ6IFwiXCIsXHJcbiAgICB1c2VySWQ6IFwiXCIsXHJcbiAgICB1c2VyczogbmV3IE1hcCgpLFxyXG59KTtcclxuZXhwb3J0IGNvbnN0IG5ld1JlcGxpY2F0aW9uU3RhdGUgPSAoKSA9PiAoe1xyXG4gICAgY29ubmVjdGlvblN0YXRlOiBcImNsb3NlZFwiLFxyXG4gICAgc2Vzc2lvbklkOiBudWxsLFxyXG59KTtcclxuZXhwb3J0IHZhciBSZXBsaWNhdGlvbkFjdGlvblR5cGU7XHJcbihmdW5jdGlvbiAoUmVwbGljYXRpb25BY3Rpb25UeXBlKSB7XHJcbiAgICBSZXBsaWNhdGlvbkFjdGlvblR5cGVbXCJjcmVhdGluZ1Nlc3Npb25cIl0gPSBcIlJFUExJQ0FUSU9OX0NSRUFUSU5HX1NFU1NJT05cIjtcclxuICAgIFJlcGxpY2F0aW9uQWN0aW9uVHlwZVtcImNvbm5lY3Rpb25SZWFkeVwiXSA9IFwiUkVQTElDQVRJT05fQ09OTkVDVElPTl9SRUFEWVwiO1xyXG4gICAgUmVwbGljYXRpb25BY3Rpb25UeXBlW1wiY29ubmVjdGlvbkNsb3NlZFwiXSA9IFwiUkVQTElDQVRJT05fQ09OTkVDVElPTl9DTE9TRURcIjtcclxuICAgIFJlcGxpY2F0aW9uQWN0aW9uVHlwZVtcImNvbm5lY3Rpb25FcnJvclwiXSA9IFwiUkVQTElDQVRJT05fQ09OTkVDVElPTl9FUlJPUlwiO1xyXG4gICAgUmVwbGljYXRpb25BY3Rpb25UeXBlW1wicmVjZWl2ZU1lc3NhZ2VcIl0gPSBcIlJFUExJQ0FUSU9OX1JFQ0VJVkVfTUVTU0FHRVwiO1xyXG4gICAgUmVwbGljYXRpb25BY3Rpb25UeXBlW1wic2VuZFBpbmdcIl0gPSBcIlJFUExJQ0FUSU9OX1NFTkRfUElOR1wiO1xyXG4gICAgUmVwbGljYXRpb25BY3Rpb25UeXBlW1wibm9vcFwiXSA9IFwiUkVQTElDQVRJT05fTk9PUFwiO1xyXG59KShSZXBsaWNhdGlvbkFjdGlvblR5cGUgfHwgKFJlcGxpY2F0aW9uQWN0aW9uVHlwZSA9IHt9KSk7XHJcbjtcclxuZXhwb3J0IHZhciBTZXNzaW9uQWN0aW9uVHlwZTtcclxuKGZ1bmN0aW9uIChTZXNzaW9uQWN0aW9uVHlwZSkge1xyXG4gICAgU2Vzc2lvbkFjdGlvblR5cGVbXCJjcmVhdGVcIl0gPSBcIlNFU1NJT05fQ1JFQVRFXCI7XHJcbiAgICBTZXNzaW9uQWN0aW9uVHlwZVtcInN0YXJ0ZWRcIl0gPSBcIlNFU1NJT05fU1RBUlRFRFwiO1xyXG4gICAgU2Vzc2lvbkFjdGlvblR5cGVbXCJlbmRlZFwiXSA9IFwiU0VTU0lPTl9FTkRFRFwiO1xyXG4gICAgU2Vzc2lvbkFjdGlvblR5cGVbXCJqb2luXCJdID0gXCJTRVNTSU9OX0pPSU5cIjtcclxuICAgIFNlc3Npb25BY3Rpb25UeXBlW1wibGVhdmVcIl0gPSBcIlNFU1NJT05fTEVBVkVcIjtcclxuICAgIFNlc3Npb25BY3Rpb25UeXBlW1wiYWRkVXNlclwiXSA9IFwiU0VTU0lPTl9BRERfVVNFUlwiO1xyXG4gICAgU2Vzc2lvbkFjdGlvblR5cGVbXCJyZW1vdmVVc2VyXCJdID0gXCJTRVNTSU9OX1JFTU9WRV9VU0VSXCI7XHJcbiAgICBTZXNzaW9uQWN0aW9uVHlwZVtcImNoYW5nZVVzZXJOYW1lXCJdID0gXCJTRVNTSU9OX0NIQU5HRV9VU0VSX05BTUVcIjtcclxuICAgIFNlc3Npb25BY3Rpb25UeXBlW1widXNlck5hbWVDaGFuZ2VkXCJdID0gXCJTRVNTSU9OX1VTRVJfTkFNRV9DSEFOR0VEXCI7XHJcbiAgICBTZXNzaW9uQWN0aW9uVHlwZVtcInNlbmRNZXNzYWdlXCJdID0gXCJSRVBMSUNBVElPTl9TRU5EX01FU1NBR0VcIjtcclxufSkoU2Vzc2lvbkFjdGlvblR5cGUgfHwgKFNlc3Npb25BY3Rpb25UeXBlID0ge30pKTtcclxuO1xyXG5leHBvcnQgY29uc3QgbmV3VXNlciA9IChpZCwgbmFtZSkgPT4gKHtcclxuICAgIGlkLFxyXG4gICAgbmFtZVxyXG59KTtcclxuZXhwb3J0IHZhciBSZXBsaWNhdGlvbk1lc3NhZ2VUeXBlO1xyXG4oZnVuY3Rpb24gKFJlcGxpY2F0aW9uTWVzc2FnZVR5cGUpIHtcclxuICAgIFJlcGxpY2F0aW9uTWVzc2FnZVR5cGVbXCJhY3Rpb25cIl0gPSBcIkFDVElPTlwiO1xyXG4gICAgLy9jcmVhdGVkID0gXCJDUkVBVEVEXCIsIC8vIHNlcnZlciBkb2VzIG5vdCB0ZWxsIHlvdSB0aGF0XHJcbiAgICBSZXBsaWNhdGlvbk1lc3NhZ2VUeXBlW1wiam9pbmVkXCJdID0gXCJKT0lORURcIjtcclxuICAgIFJlcGxpY2F0aW9uTWVzc2FnZVR5cGVbXCJ1c2VySm9pbmVkXCJdID0gXCJVU0VSX0pPSU5FRFwiO1xyXG4gICAgUmVwbGljYXRpb25NZXNzYWdlVHlwZVtcInVzZXJMZWZ0XCJdID0gXCJVU0VSX0xFRlRcIjtcclxuICAgIFJlcGxpY2F0aW9uTWVzc2FnZVR5cGVbXCJ1c2VyQ2hhbmdlZE5hbWVcIl0gPSBcIlVTRVJfQ0hBTkdFRF9OQU1FXCI7XHJcbn0pKFJlcGxpY2F0aW9uTWVzc2FnZVR5cGUgfHwgKFJlcGxpY2F0aW9uTWVzc2FnZVR5cGUgPSB7fSkpO1xyXG5leHBvcnQgdmFyIENsaWVudFJlcXVlc3RUeXBlO1xyXG4oZnVuY3Rpb24gKENsaWVudFJlcXVlc3RUeXBlKSB7XHJcbiAgICBDbGllbnRSZXF1ZXN0VHlwZVtcImFjdGlvblwiXSA9IFwiQUNUSU9OXCI7XHJcbiAgICBDbGllbnRSZXF1ZXN0VHlwZVtcImNyZWF0ZVwiXSA9IFwiQ1JFQVRFXCI7XHJcbiAgICBDbGllbnRSZXF1ZXN0VHlwZVtcImpvaW5cIl0gPSBcIkpPSU5cIjtcclxuICAgIENsaWVudFJlcXVlc3RUeXBlW1wicGluZ1wiXSA9IFwiUElOR1wiO1xyXG4gICAgQ2xpZW50UmVxdWVzdFR5cGVbXCJjaGFuZ2VOYW1lXCJdID0gXCJDSEFOR0VfTkFNRVwiO1xyXG4gICAgQ2xpZW50UmVxdWVzdFR5cGVbXCJsZWF2ZVwiXSA9IFwiTEVBVkVcIjtcclxufSkoQ2xpZW50UmVxdWVzdFR5cGUgfHwgKENsaWVudFJlcXVlc3RUeXBlID0ge30pKTtcclxuIiwiaW1wb3J0IHsgUmVwbGljYXRpb25BY3Rpb25UeXBlIGFzIFJBVCwgUmVwbGljYXRpb25NZXNzYWdlVHlwZSB9IGZyb20gXCIuL3R5cGVzXCI7XHJcbmltcG9ydCAqIGFzIFdTIGZyb20gXCIuL3dlYnNvY2tldFByaW1pdGl2ZXNcIjtcclxuLy9jb25zb2xlLmxvZyhcIndlYndvcmtlciBydW5uaW5nXCIpXHJcbmxldCB3cyA9IG51bGw7XHJcbmxldCBzZXNzaW9uSWQgPSBudWxsO1xyXG5sZXQgcGluZ1RpbWVyID0gbnVsbDtcclxubGV0IHdzQ2xvc2VkID0gZmFsc2U7XHJcbi8vIFdvcmtlciAnSU8nXHJcbm9ubWVzc2FnZSA9IChlKSA9PiB7XHJcbiAgICBsZXQgbWVzc2FnZSA9IGUuZGF0YTtcclxuICAgIHN3aXRjaCAobWVzc2FnZS5mdW5jKSB7XHJcbiAgICAgICAgY2FzZSBcIkNSRUFURVwiOlxyXG4gICAgICAgICAgICB3cyA9IGNyZWF0ZShtZXNzYWdlLnBheWxvYWQuc2VydmVyQWRkcmVzcywgbWVzc2FnZS5wYXlsb2FkLnNlcmlhbGl6YWJsZVN0YXRlKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgY2FzZSBcIkpPSU5cIjpcclxuICAgICAgICAgICAgd3MgPSBqb2luKG1lc3NhZ2UucGF5bG9hZC5zZXJ2ZXJBZGRyZXNzLCBtZXNzYWdlLnBheWxvYWQuc2Vzc2lvbklkKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgY2FzZSBcIkNIQU5HRV9OQU1FXCI6XHJcbiAgICAgICAgICAgIGlmICh3cyAmJiBzZXNzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICBXUy5jaGFuZ2VOYW1lKHdzLCBtZXNzYWdlLnBheWxvYWQubmV3TmFtZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIGNhc2UgXCJURVJNSU5BVEVcIjpcclxuICAgICAgICAgICAgaWYgKHdzKVxyXG4gICAgICAgICAgICAgICAgdGVybWluYXRlKHdzKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgY2FzZSBcIlNFTkRcIjpcclxuICAgICAgICAgICAgaWYgKHdzICYmIHNlc3Npb25JZClcclxuICAgICAgICAgICAgICAgIFdTLnNlbmQod3MsIG1lc3NhZ2UucGF5bG9hZC5tZXNzYWdlKTtcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxufTtcclxuY29uc3Qgc2VuZFRvTWFpbiA9IChtZXNzYWdlKSA9PiB7XHJcbiAgICBwb3N0TWVzc2FnZShtZXNzYWdlKTtcclxufTtcclxuY29uc3QgZGlzcGF0Y2ggPSAoYWN0aW9uKSA9PiB7XHJcbiAgICBzZW5kVG9NYWluKHsgZXZlbnQ6IFwiRElTUEFUQ0hcIiwgcGF5bG9hZDogeyBhY3Rpb24gfSB9KTtcclxufTtcclxuLy8gQ29ubmVjdGlvbiBzZXR1cFxyXG5jb25zdCBjb25zdHJ1Y3RvciA9IChzZXJ2ZXJBZGRyZXNzKSA9PiB7XHJcbiAgICBsZXQgd3MgPSBuZXcgV2ViU29ja2V0KHNlcnZlckFkZHJlc3MpO1xyXG4gICAgd3Mub25tZXNzYWdlID0gKGV2KSA9PiBvbk1lc3NhZ2UoZXYpO1xyXG4gICAgd3Mub25jbG9zZSA9IChldikgPT4gb25DbG9zZShldik7XHJcbiAgICB3cy5vbmVycm9yID0gKGV2KSA9PiBvbkVycm9yKGV2KTtcclxuICAgIHJldHVybiB3cztcclxufTtcclxuY29uc3QgY3JlYXRlID0gKHNlcnZlckFkZHJlc3MsIHNlcmlhbGl6YWJsZVN0YXRlKSA9PiB7XHJcbiAgICBsZXQgd3MgPSBjb25zdHJ1Y3RvcihzZXJ2ZXJBZGRyZXNzKTtcclxuICAgIHN0YXJ0UGluZ1RpbWVyKHdzKTtcclxuICAgIHdzLm9ub3BlbiA9IChldikgPT4ge1xyXG4gICAgICAgIFdTLmNyZWF0ZVNlc3Npb24od3MsIHNlcmlhbGl6YWJsZVN0YXRlKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gd3M7XHJcbn07XHJcbmNvbnN0IGpvaW4gPSAoc2VydmVyQWRkcmVzcywgc2Vzc2lvbklkKSA9PiB7XHJcbiAgICBsZXQgd3MgPSBjb25zdHJ1Y3RvcihzZXJ2ZXJBZGRyZXNzKTtcclxuICAgIHN0YXJ0UGluZ1RpbWVyKHdzKTtcclxuICAgIHdzLm9ub3BlbiA9IChldikgPT4ge1xyXG4gICAgICAgIFdTLmpvaW5TZXNzaW9uKHdzLCBzZXNzaW9uSWQpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB3cztcclxufTtcclxuY29uc3Qgc3RhcnRQaW5nVGltZXIgPSAod3MpID0+IHtcclxuICAgIHBpbmdUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICBXUy5zZW5kUGluZyh3cyk7XHJcbiAgICB9LCAxMDAwKTtcclxufTtcclxuLy8gdGVhcmRvd25cclxuY29uc3QgdGVybWluYXRlID0gKHdzKSA9PiB7XHJcbiAgICB3c0Nsb3NlZCA9IHRydWU7XHJcbiAgICBzZXNzaW9uSWQgPSBudWxsO1xyXG4gICAgaWYgKHBpbmdUaW1lciAhPT0gbnVsbClcclxuICAgICAgICBjbGVhckludGVydmFsKHBpbmdUaW1lcik7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIFdTLmxlYXZlU2Vzc2lvbih3cyk7XHJcbiAgICAgICAgd3MuY2xvc2UoKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIC8vIG5vdGhpbmcgdG8gZG8gaGVyZS5cclxuICAgIH1cclxufTtcclxuLy8gV2Vic29ja2V0IGJlaGF2aW9yXHJcbmNvbnN0IG9uTWVzc2FnZSA9IChldikgPT4ge1xyXG4gICAgbGV0IG1lc3NhZ2UgPSBKU09OLnBhcnNlKGV2LmRhdGEpO1xyXG4gICAgaWYgKG1lc3NhZ2UuY29tbWFuZCA9PSBSZXBsaWNhdGlvbk1lc3NhZ2VUeXBlLmpvaW5lZCkge1xyXG4gICAgICAgIHNlc3Npb25JZCA9IG1lc3NhZ2UucGF5bG9hZC5zZXNzaW9uSWQ7XHJcbiAgICAgICAgc2VuZFRvTWFpbih7IGV2ZW50OiBcIlNFU1NJT05fSURcIiwgcGF5bG9hZDogbWVzc2FnZS5wYXlsb2FkIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKHNlc3Npb25JZCAhPT0gbnVsbCkge1xyXG4gICAgICAgIGRpc3BhdGNoKHsgdHlwZTogUkFULnJlY2VpdmVNZXNzYWdlLCBwYXlsb2FkOiB7IG1lc3NhZ2UsIHNlc3Npb25JZDogc2Vzc2lvbklkIH0gfSk7XHJcbiAgICB9XHJcbn07XHJcbmNvbnN0IG9uQ2xvc2UgPSAoZXYpID0+IHtcclxuICAgIGlmICh3cylcclxuICAgICAgICB0ZXJtaW5hdGUod3MpO1xyXG4gICAgc2VuZFRvTWFpbih7IGV2ZW50OiBcIkNMT1NFXCIgfSk7XHJcbn07XHJcbmNvbnN0IG9uRXJyb3IgPSAoZXYpID0+IHtcclxuICAgIGlmICh3cylcclxuICAgICAgICB0ZXJtaW5hdGUod3MpO1xyXG4gICAgc2VuZFRvTWFpbih7IGV2ZW50OiBcIkVSUk9SXCIgfSk7XHJcbn07XHJcbiIsImltcG9ydCB7IENsaWVudFJlcXVlc3RUeXBlIH0gZnJvbSBcIi4uL3JlcGxpY2F0aW9uX3dzL3R5cGVzXCI7XHJcbi8qIGZvciByZWZlcmVuY2Ugb25seVxyXG5jb25zdCBuZXdDb25uZWN0aW9uID0gKFxyXG4gIHVyaTogc3RyaW5nLFxyXG4gIG9uT3BlbjogKGV2OiBFdmVudCkgPT4gYW55LFxyXG4gIG9uTWVzc2FnZTogKGV2OiBNZXNzYWdlRXZlbnQpID0+IGFueSxcclxuICBvbkNsb3NlOiAoZXY6IENsb3NlRXZlbnQpID0+IGFueSxcclxuICBvbkVycm9yOiAoZXY6IEV2ZW50KSA9PiBhbnlcclxuKTogV2ViU29ja2V0ID0+IHtcclxuICBsZXQgd3MgPSBuZXcgV2ViU29ja2V0KHVyaSk7XHJcbiAgd3Mub25vcGVuID0gb25PcGVuO1xyXG4gIHdzLm9ubWVzc2FnZSA9IChldjogTWVzc2FnZUV2ZW50KTogYW55ID0+IHtcclxuICAgIC8vY29uc29sZS5sb2coXCJtZXNzYWdlOiBcIiwgZXYuZGF0YSk7XHJcbiAgICBvbk1lc3NhZ2UoZXYpO1xyXG4gIH07XHJcbiAgd3Mub25jbG9zZSA9IChldjogQ2xvc2VFdmVudCk6IGFueSA9PiB7XHJcbiAgICBvbkNsb3NlKGV2KTtcclxuICB9O1xyXG4gIHdzLm9uZXJyb3IgPSBvbkVycm9yO1xyXG4gIHJldHVybiB3cztcclxufVxyXG4qL1xyXG5leHBvcnQgY29uc3Qgc2VuZCA9ICh3cywgbWVzc2FnZSkgPT4ge1xyXG4gICAgd3Muc2VuZChKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XHJcbn07XHJcbmV4cG9ydCBjb25zdCBzZW5kUGluZyA9ICh3cykgPT4ge1xyXG4gICAgLy9jb25zb2xlLmxvZyhcInNlbmRpbmcgcGluZ1wiKVxyXG4gICAgd3Muc2VuZChKU09OLnN0cmluZ2lmeSh7IGNvbW1hbmQ6IENsaWVudFJlcXVlc3RUeXBlLnBpbmcgfSkpO1xyXG59O1xyXG5leHBvcnQgY29uc3QgY3JlYXRlU2Vzc2lvbiA9ICh3cywgc2VyaXphYmxlU3RhdGUpID0+IHtcclxuICAgIHdzLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBjb21tYW5kOiBDbGllbnRSZXF1ZXN0VHlwZS5jcmVhdGUsIHBheWxvYWQ6IHsgc3RhdGU6IHNlcml6YWJsZVN0YXRlIH0gfSkpO1xyXG59O1xyXG5leHBvcnQgY29uc3Qgam9pblNlc3Npb24gPSAod3MsIHNlc3Npb25JZCkgPT4ge1xyXG4gICAgd3Muc2VuZChKU09OLnN0cmluZ2lmeSh7IGNvbW1hbmQ6IENsaWVudFJlcXVlc3RUeXBlLmpvaW4sIHBheWxvYWQ6IHsgc2Vzc2lvbklkIH0gfSkpO1xyXG59O1xyXG5leHBvcnQgY29uc3QgY2hhbmdlTmFtZSA9ICh3cywgbmFtZSkgPT4ge1xyXG4gICAgd3Muc2VuZChKU09OLnN0cmluZ2lmeSh7IGNvbW1hbmQ6IENsaWVudFJlcXVlc3RUeXBlLmNoYW5nZU5hbWUsIHBheWxvYWQ6IHsgbmFtZSB9IH0pKTtcclxufTtcclxuZXhwb3J0IGNvbnN0IGxlYXZlU2Vzc2lvbiA9ICh3cykgPT4ge1xyXG4gICAgd3Muc2VuZChKU09OLnN0cmluZ2lmeSh7IGNvbW1hbmQ6IENsaWVudFJlcXVlc3RUeXBlLmxlYXZlIH0pKTtcclxuICAgIHdzLmNsb3NlKCk7XHJcbn07XHJcbiJdLCJuYW1lcyI6WyJSZXBsaWNhdGlvbkFjdGlvblR5cGUiLCJTZXNzaW9uQWN0aW9uVHlwZSIsIlJlcGxpY2F0aW9uTWVzc2FnZVR5cGUiLCJDbGllbnRSZXF1ZXN0VHlwZSIsIndzIiwic2Vzc2lvbklkIiwicGluZ1RpbWVyIiwid3NDbG9zZWQiLCJvbm1lc3NhZ2UiLCJlIiwibWVzc2FnZSIsImRhdGEiLCJmdW5jIiwiY3JlYXRlIiwicGF5bG9hZCIsInNlcnZlckFkZHJlc3MiLCJzZXJpYWxpemFibGVTdGF0ZSIsImpvaW4iLCJuYW1lIiwic2VuZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb21tYW5kIiwiY2hhbmdlTmFtZSIsIm5ld05hbWUiLCJ0ZXJtaW5hdGUiLCJzZW5kVG9NYWluIiwicG9zdE1lc3NhZ2UiLCJXZWJTb2NrZXQiLCJldiIsIm9uTWVzc2FnZSIsIm9uY2xvc2UiLCJvbkNsb3NlIiwib25lcnJvciIsIm9uRXJyb3IiLCJzdGFydFBpbmdUaW1lciIsIm9ub3BlbiIsInNlcml6YWJsZVN0YXRlIiwic3RhdGUiLCJzZXRJbnRlcnZhbCIsInBpbmciLCJjbGVhckludGVydmFsIiwibGVhdmUiLCJjbG9zZSIsImVycm9yIiwicGFyc2UiLCJhY3Rpb24iLCJqb2luZWQiLCJldmVudCIsInR5cGUiLCJyZWNlaXZlTWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=