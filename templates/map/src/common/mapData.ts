import {StoreState} from "../store";
import {Target, Weapon} from "../world/types";
import {getEntitiesByType} from "../world/world";
import {getTranslation} from "../world/transformations";
import {getHeight} from "../heightmap/heightmap";
import {getMortarFiringSolution} from "../world/projectilePhysics";
import {US_MIL} from "../world/constants";

export const maps = {
  //default scale 100, default rotation 0
  "albasrah": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/albasrah_minimap.jpg",
      "heightmap_image_src": "maps/albasrah_heightmap.png",
      "landscape": {
        "loc_x": -203206.40625 + 508 * 100, "loc_y": -203200.0 + 508 * 100,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 10.0,
        "resolution_x": 3049, "resolution_y": 3049
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -152000.0, "loc_y": -152000.0},
      "mapTextureCorner1": {"loc_x": 152000.0, "loc_y": 152000.0},
      "compression": {"z_translate": 0}
  },
  "anvil": {
    "reference": "AAS_v1",
    "minimap_image_src": "maps/anvil_minimap.jpg",
    "heightmap_image_src": "maps/anvil_heightmap.png",
    "landscape": {
      "loc_x": -204000.0, "loc_y": -204000.0,
      "scale_x": 75.0, "scale_y": 75.0, "scale_z": 45.0,
      "resolution_x": 4081, "resolution_y": 4081
    },
    "mapTexture": {"size_x": 4096, "size_y": 4096},
    "mapTextureCorner0": {"loc_x": -204000.0, "loc_y": -204000.0},
    "mapTextureCorner1": {"loc_x": 102000.0, "loc_y":  102000.0},
    "compression": {"z_translate": 0}
},
  "belaya": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/belaya_minimap.jpg",
      "heightmap_image_src": "maps/belaya_heightmap.png",
      "landscape": {
        "loc_x": -201600, "loc_y": -214200,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 120.0,
        "resolution_x": 4033, "resolution_y": 4033
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -195400.0, "loc_y": 182500.0},
      "mapTextureCorner1": {"loc_x": 195000.0, "loc_y": -208000.0},
      "compression": {"z_translate": 0}
  },
  "blackcoast": {
    "reference": "AAS_v1",
    "minimap_image_src": "maps/blackcoast_minimap.jpg",
    "heightmap_image_src": "maps/blackcoast_heightmap.png",
    "landscape": {
      "loc_x": -204000.578125, "loc_y": -214250.390625,
      "scale_x": 100.3937, "scale_y": 100.3937, "scale_z": 80.0,
      "resolution_x": 4033, "resolution_y": 4033
    },
    "mapTexture": {"size_x": 4096, "size_y": 4096},
    "mapTextureCorner0": {"loc_x": -229999.515625, "loc_y": -212746.78125},
    "mapTextureCorner1": {"loc_x": 229998.46875, "loc_y": 247251.0625},
    "compression": {"z_translate": 0}
},
  "chora": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/chora_minimap.jpg",
      "heightmap_image_src": "maps/chora_heightmap.png",
      "landscape": {
        "loc_x": -246400.0, "loc_y": -266400.0 + 76200,
        "scale_x": 50.0, "scale_y": 50.0, "scale_z": 400.0,
        "resolution_x": 8129, "resolution_y": 4827
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -246400.0, "loc_y": -266400.0},
      "mapTextureCorner1": {"loc_x": 159990.0, "loc_y": 140000.0},
      "compression": {"z_translate": 0}
  },
  "fallujah": {
    "reference": "AAS_v1",
    "minimap_image_src": "maps/fallujah_minimap.jpg",
    "heightmap_image_src": "maps/fallujah_heightmap.png",
    "landscape": {
      "loc_x": -204000.0 + 0 * 100, "loc_y": -204000.0 + 0 * 100,
      "scale_x": 100.0, "scale_y": 100.0, "scale_z": 100.0,
      "resolution_x": 4081, "resolution_y": 4081
    },
    "mapTexture": {"size_x": 4096, "size_y": 4096},
    "mapTextureCorner0": {"loc_x": -131500.0, "loc_y": -154500.0},
    "mapTextureCorner1": {"loc_x": 169000.0, "loc_y": 146000.0},
    "compression": {"z_translate": 0}
  },
  "foolsroad": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/foolsroad_minimap.jpg",
      "heightmap_image_src": "maps/foolsroad_heightmap.png",
      "landscape": {
        "loc_x": -261809.515625 + 1020 * 100, "loc_y": -263130.0 + 765 * 100,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 320.0,
        "resolution_x": 2806, "resolution_y": 2806
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": 44805.078125, "loc_y": 44805.078125},
      "mapTextureCorner1": {"loc_x": -132576.921875, "loc_y": -132576.921875},
      "compression": {"z_translate": 0}
  },
  "goosebay": {
    "reference": "AAS_v1",
    "minimap_image_src": "maps/goosebay_minimap.jpg",
    "heightmap_image_src": "maps/goosebay_heightmap.png",
    "contourmap_image_src": "maps/goosebay_contourmap.svg",
    "landscape": {
      "loc_x": -203256.890625, "loc_y": -203274.84375,
      "scale_x": 100.0, "scale_y": 100.0, "scale_z": 40.0,
      "resolution_x": 4065, "resolution_y": 4065
    },
    "mapTexture": {"size_x": 4096, "size_y": 4096},
    "mapTextureCorner0": {"loc_x": -201657.890625, "loc_y": -201674.84375},
    "mapTextureCorner1": {"loc_x": 201523.078125, "loc_y": 201503.078125},
    "compression": {"z_translate": 0}
},
  "gorodok": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/gorodok_minimap.jpg",
      "heightmap_image_src": "maps/gorodok_heightmap.png",
      "landscape": {
        "loc_x": -203199.203125, "loc_y": -203200.0,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 1000.0,
        "resolution_x": 4065, "resolution_y": 4065
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -203199.0, "loc_y": 203200.0},
      "mapTextureCorner1": {"loc_x": 203201.0, "loc_y": -203200.0},
      "compression": {"z_translate": 0}
  },
  "harju": {
    "reference": "AAS_v1",
    "minimap_image_src": "maps/harju_minimap.jpg",
    "heightmap_image_src": "maps/harju_heightmap.png",
    "landscape": {
      "loc_x": -201599.359375, "loc_y": -201600.765625,
      "scale_x": 100.0, "scale_y": 100.0, "scale_z": 100.0,
      "resolution_x": 4033, "resolution_y": 4033
    },
    "mapTexture": {"size_x": 4096, "size_y": 4096},
    "mapTextureCorner0": {"loc_x": -201600.0, "loc_y": -201600.0},
    "mapTextureCorner1": {"loc_x": 201600.0, "loc_y": 201600.0},
    "compression": {"z_translate": 0}
},
  "jensensrange": {
      "reference": "v2",
      "minimap_image_src": "maps/jensensrange_minimap.jpg",
      "heightmap_image_src": "maps/jensensrange_heightmap.png",
      "landscape": {
        "loc_x": -204051.40625, "loc_y": -204014.078125,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 100.0,
        "resolution_x": 4081, "resolution_y": 4081
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": 200400.0, "loc_y":-200400.0},
      "mapTextureCorner1": {"loc_x": -200400.0, "loc_y": 200400.0},
      "compression": {"z_translate": 0}
  },
  "kamdesh": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/kamdesh_minimap.jpg",
      "heightmap_image_src": "maps/kamdesh_heightmap.png",
      "landscape": {
        "loc_x": -201600.0, "loc_y": -201600.0,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 135.0,
        "resolution_x": 4033, "resolution_y": 4033
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -201600.0, "loc_y": -201600.0},
      "mapTextureCorner1": {"loc_x": 201600.0, "loc_y": 201600.0},
      "compression": {"z_translate": 0}
  },
  "kohat": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/kohat_minimap.jpg",
      "heightmap_image_src": "maps/kohat_heightmap.png",
      "landscape": {
        "loc_x": -201602.3125, "loc_y": -201600.0,
        "scale_x": 100, "scale_y": 100, "scale_z": 75.0,
        "resolution_x": 4065, "resolution_y": 4065
       },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -230000.0, "loc_y": -230000.0},
      "mapTextureCorner1": {"loc_x": 231700.0, "loc_y": 231700.0},
      "compression": {"z_translate": 0}
   },
  "kokan": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/kokan_minimap.jpg",
      "heightmap_image_src": "maps/kokan_heightmap.png",
      "contourmap_image_src": "maps/kokan_contourmap.svg",
      "landscape": {
        "loc_x": -107899.648438 - 508 * 50, "loc_y": -107900.0 - 1270 * 50,
        "scale_x": 50.0, "scale_y": 50.0, "scale_z": 100.0,
        "resolution_x": 6097, "resolution_y": 7367
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": 142013.671875, "loc_y": 142013.671875},
      "mapTextureCorner1": {"loc_x": -107634.9375, "loc_y": -107566.75},
      "compression": {"z_translate": 0}
  },
  "lashkar": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/lashkar_minimap.jpg",
      "heightmap_image_src": "maps/lashkar_heightmap.png",
      "landscape": {
        "loc_x": -216700.0, "loc_y":-216700.0,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 150.0,
        "resolution_x": 4336, "resolution_y": 4336
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": 216700.0, "loc_y": 216700.0},
      "mapTextureCorner1": {"loc_x": -216700.0, "loc_y": -216700.0},
      "compression": {"z_translate": 0}
  },
  "logar": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/logar_minimap.jpg",
      "heightmap_image_src": "maps/logar_heightmap.png",
      "landscape": {
        "loc_x": -201598.0 + 630 * 99.98999, "loc_y":-201598.0 + 756 * 99.98999,
        "scale_x": 99.98999, "scale_y": 99.98999, "scale_z": 49.98999,
        "resolution_x": 2773, "resolution_y": 1891
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": 87978.328125, "loc_y": 62921.710938},
      "mapTextureCorner1": {"loc_x": -88145.140625, "loc_y": -113238.757812},
      "compression": {"z_translate": 0}
  },
  "manic": {
    "reference": "AAS_v1",
    "minimap_image_src": "maps/manic_minimap.jpg",
    "heightmap_image_src": "maps/manic_heightmap.png",
    "landscape": {
      "loc_x": -203222.328125, "loc_y": -203210.015625,
      "scale_x": 100.0, "scale_y": 100.0, "scale_z": 300.0,
      "resolution_x": 4065, "resolution_y": 4065
    },
    "mapTexture": {"size_x": 4096, "size_y": 4096},
    "mapTextureCorner0": {"loc_x": -201657.890625, "loc_y":-201674.84375},
    "mapTextureCorner1": {"loc_x": 201523.078125, "loc_y": 201503.078125},
    "compression": {"z_translate": 0}
  },
  "manicouagan": {
    "reference": "AAS_v1",
    "minimap_image_src": "maps/manicouagan_minimap.jpg",
    "heightmap_image_src": "maps/manicouagan_heightmap.png",
    "landscape": {
      "loc_x": -203221.609375, "loc_y": -203209.890625,
      "scale_x": 100.0, "scale_y": 100.0, "scale_z": 300.0,
      "resolution_x": 4065, "resolution_y": 4065
    },
    "mapTexture": {"size_x": 4096, "size_y": 4096},
    "mapTextureCorner0": {"loc_x": -201657.890625, "loc_y":-201674.84375},
    "mapTextureCorner1": {"loc_x": 201523.078125, "loc_y": 201503.078125},
    "compression": {"z_translate": 0}
  },
  "mestia": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/mestia_minimap.jpg",
      "heightmap_image_src": "maps/mestia_heightmap.png",
      "landscape": {
        "loc_x": -231000.0 + 765 * 100, "loc_y": -192695.453125 + 765 * 100,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 120.0,
        "resolution_x": 3061, "resolution_y": 2551
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": 120000.0, "loc_y": 130000.0},
      "mapTextureCorner1": {"loc_x": -120000.0, "loc_y": -110000.0},
      "compression": {"z_translate": 0}
  },
  "mutaha": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/mutaha_minimap.jpg",
      "heightmap_image_src": "maps/mutaha_heightmap.png",
      "landscape": {
        "loc_x": -382502.0 + 2040 * 100, "loc_y": -382500.0 + 2040 * 100,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 30.0,
        "resolution_x": 4081, "resolution_y": 4081
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -93500.0, "loc_y": 161500.0},
      "mapTextureCorner1": {"loc_x": 182000.0, "loc_y": -114000.0},
      "compression": {"z_translate": 0}
  },
  "narva": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/narva_minimap.jpg",
      "heightmap_image_src": "maps/narva_heightmap.png",
      "landscape": {
        "loc_x": -203200.0, "loc_y": -203200.0,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 100.0,
        "resolution_x": 4065, "resolution_y": 4065
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -138970.6875, "loc_y": 139792.515625},
      "mapTextureCorner1": {"loc_x": 141029.375, "loc_y": -140207.4375},
      "compression": {"z_translate": 0}
  },
  "skorpo": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/skorpo_minimap_aas_v1.jpg",
      "heightmap_image_src": "maps/skorpo_heightmap.png",
      "landscape": {
        "loc_x": -481127.25, "loc_y": -394791.78125,
        "scale_x": 120.0, "scale_y": 120.0, "scale_z": 350.0,
        "slice_x": 508, "slice_y": 1524,
        "rot_z": -2.006195,
        "resolution_x": 7113, "resolution_y": 5081

        // "min_x": -420167.25, "max_x":  402792.75 // max_x + 254*120
        // "min_y": -211911.78125, "max_y": 367208.21875
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": 340000.0, "loc_y": 250000.0},
      "mapTextureCorner1": {"loc_x": -130000.0, "loc_y": -220000.0},
      "compression": {"z_translate": 0}
  },
    skorpoFull: {
        reference: "RAAS_v1",
        minimap_image_src: "maps/skorpo_minimap_full.jpg",
        heightmap_image_src: "maps/skorpo_heightmap.png",
        landscape: {
            loc_x: -481127.25,
            loc_y: -394791.78125,
            scale_x: 120,
            scale_y: 120,
            scale_z: 350,
            slice_x: 508,
            slice_y: 1524,
            rot_z: -2.006195,
            resolution_x: 7113,
            resolution_y: 5081
        },
        mapTexture: {size_x: 4096, size_y: 4096},
        mapTextureCorner0: {loc_x: 324850, loc_y: 357608},
        mapTextureCorner1: {loc_x: -360150, loc_y: -329300},
        compression: {z_translate: 0}
    },
  "sumari": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/sumari_minimap.jpg",
      "heightmap_image_src": "maps/sumari_heightmap.png",
      "landscape": {
        "loc_x": -99200.820312 + 310 * 100, "loc_y": -99199.453125 + 620 * 100,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 75.0,
        "resolution_x": 1427, "resolution_y": 1055
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -63973.925781, "loc_y": -44728.078125},
      "mapTextureCorner1": {"loc_x": 66033.578125, "loc_y": 85297.234375},
      "compression": {"z_translate": 0}
  },
  "tallil": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/tallil_minimap.jpg",
      "heightmap_image_src": "maps/tallil_heightmap.png",
      "landscape": {
        "loc_x": -203198.625 - 254 * 100, "loc_y": -203200.65625 - 254 * 100,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 125.0,
        "resolution_x": 4573, "resolution_y": 4573
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -234000.015625, "loc_y": -234000.0},
      "mapTextureCorner1": {"loc_x": 234000.0, "loc_y": 234000.0},
      "compression": {"z_translate": 0}
  },
  "yehorivka": {
      "reference": "AAS_v1",
      "minimap_image_src": "maps/yehorivka_minimap.jpg",
      "heightmap_image_src": "maps/yehorivka_heightmap.png",
      "landscape": {
        "loc_x": -406397.0 + 762 * 100, "loc_y": -406400.0 + 762 * 100,
        "scale_x": 100.0, "scale_y": 100.0, "scale_z": 400.0,
        "resolution_x": 6351, "resolution_y": 6351
      },
      "mapTexture": {"size_x": 4096, "size_y": 4096},
      "mapTextureCorner0": {"loc_x": -330197.40625, "loc_y": -330199.5},
      "mapTextureCorner1": {"loc_x": 304803.0, "loc_y": 304800.0},
      "compression": {"z_translate": 0}
  },
  "yehorivka_skirmish_v1": {
    "reference": "Skirmish_v1",
    "minimap_image_src": "maps/yehorivka_skirmish_v1_minimap.jpg",
    "heightmap_image_src": "maps/yehorivka_heightmap.png",
    "landscape": {
      "loc_x": -406397.0 + 762 * 100, "loc_y": -406400.0 + 762 * 100,
      "scale_x": 100.0, "scale_y": 100.0, "scale_z": 400.0,
      "resolution_x": 6351, "resolution_y": 6351
    },
    "mapTexture": {"size_x": 4096, "size_y": 4096},
    "mapTextureCorner0": {"loc_x": -120000.0, "loc_y": 75000.0},
    "mapTextureCorner1": {"loc_x": 158000.0, "loc_y": -203000.0},
    "compression": {"z_translate": 0}
},
    "sanxianislands": {
        "reference": "AAS_v1",
        "minimap_image_src": "maps/sanxianislands_minimap.jpg",
        "heightmap_image_src": "maps/sanxian_heightmap.png",
        "landscape": {
            "loc_x": -204000,"loc_y": -204000,
            "scale_x": 100,"scale_y": 100,"scale_z": 100,
            "resolution_x": 4081,"resolution_y": 4081
        },
        "mapTexture": {
            "size_x": 4096, "size_y": 4096
        },
        "mapTextureCorner0": {"loc_x": -230000,"loc_y": -205000},
        "mapTextureCorner1": {"loc_x": 230000,"loc_y": 255000},
        "compression": {"z_translate": 0 }
    },
}
export const getSolution = (state: StoreState, target: any) => {

    const userSettings = state.userSettings

    const weapon = getEntitiesByType<Weapon>(state.world, "Weapon").filter((w: Weapon) => w.isActive)[0]

    const weaponTranslation = getTranslation(weapon.transform)
    const weaponHeight = getHeight(state.heightmap, weaponTranslation)
    weaponTranslation[2] = weaponHeight +  weapon.heightOverGround;
    const targetTranslation = getTranslation(target.transform);
    const targetHeight = getHeight(state.heightmap, targetTranslation)
    targetTranslation[2] = targetHeight;
    let solution = getMortarFiringSolution(weaponTranslation, targetTranslation).highArc;
    let angleValue = userSettings.weaponType === "technicalMortar" ? solution.angle / Math.PI * 180 : solution.angle * US_MIL;

    // debugger
    // angleValue=parseFloat(angleValue.toFixed(0))
    // solution.dir=parseFloat(solution.dir.toFixed(1))
    return {
        solution,
        angleValue
    }
}
